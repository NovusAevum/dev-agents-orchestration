@startuml execution-flow
!theme cyborg-outline
skinparam backgroundColor #0a0e27
skinparam sequenceMessageAlign center
skinparam responseMessageBelowArrow true
skinparam shadowing false

title <size:20><b>âš¡ Parallel Execution Flow</b></size>\n<size:12><i>Four-phase agent orchestration</i></size>

actor "ğŸ‘¤ User" as User #00d4ff
participant "ğŸ­ Master\nOrchestrator" as Master #ff6b6b
participant "ğŸ”€ Agent\nRouter" as Router #ff9068
participant "ğŸ¤– Agent\nPool" as Agents #4ecdc4
participant "ğŸ’¡ Skills" as Skills #9b59b6
participant "ğŸ”Œ MCP\nServers" as MCP #2ecc71
participant "â˜ï¸ External\nServices" as External #e74c3c

User -> Master: <b>Task Request</b>
activate Master

== <b><color:#ffff00>âš’ï¸ PHASE 1: PLANNING</color></b> ==
Master -> Master: <b>Analyze Requirements</b>
Master -> Master: <b>Decompose into Atomic Tasks</b>
Master -> Master: <b>Select Optimal Agents</b>
Master -> Master: <b>Determine Execution Mode</b>
Master -> Master: <b>Estimate Token Budget</b>

Master -> Router: <b>Deploy Agents (Parallel)</b> âš¡
activate Router

== <b><color:#00ff00>âš”ï¸ PHASE 2: PARALLEL EXECUTION</color></b> ==

par <b>Agent 1: auto-debugger</b>
  Router -> Agents: <color:#4ecdc4><b>auto-debugger</b></color>
  activate Agents
  Agents -> Skills: <b>Load Debugging Skill</b>
  activate Skills
  Skills --> Agents: <i>Skill Loaded</i>
  deactivate Skills

  Agents -> MCP: <b>GitHub MCP (Code Context)</b>
  activate MCP
  MCP -> External: <b>Fetch Repository Data</b>
  activate External
  External --> MCP: <i>Repository Context</i>
  deactivate External
  MCP --> Agents: <i>Enhanced Context</i>
  deactivate MCP

  Agents -> Agents: <b>Execute Fix</b> ğŸ”§
  Agents -> Agents: <b>Run Tests</b> âœ…
  Agents --> Router: <color:#00b894><b>âœ“ Result</b></color>
  deactivate Agents

else <b>Agent 2: production-refactor</b>
  Router -> Agents: <color:#96ceb4><b>production-refactor</b></color>
  activate Agents
  Agents -> Skills: <b>Load Refactoring Patterns</b>
  activate Skills
  Skills --> Agents: <i>Patterns Loaded</i>
  deactivate Skills

  Agents -> MCP: <b>Memory MCP (Historical Context)</b>
  activate MCP
  MCP -> External: <b>Retrieve Past Refactors</b>
  activate External
  External --> MCP: <i>Historical Data</i>
  deactivate External
  MCP --> Agents: <i>Pattern Insights</i>
  deactivate MCP

  Agents -> Agents: <b>Execute Refactor</b> ğŸ—ï¸
  Agents -> Agents: <b>Validate Changes</b> âœ…
  Agents --> Router: <color:#00b894><b>âœ“ Result</b></color>
  deactivate Agents

else <b>Agent 3: test-runner</b>
  Router -> Agents: <color:#fdcb6e><b>test-runner</b></color>
  activate Agents
  Agents -> Skills: <b>Load Test Strategies</b>
  activate Skills
  Skills --> Agents: <i>Strategies Loaded</i>
  deactivate Skills

  Agents -> MCP: <b>Semgrep MCP (Security)</b>
  activate MCP
  MCP -> External: <b>Scan for Vulnerabilities</b>
  activate External
  External --> MCP: <i>Security Report</i>
  deactivate External
  MCP --> Agents: <i>Security Context</i>
  deactivate MCP

  Agents -> Agents: <b>Run Test Suite</b> ğŸ§ª
  Agents -> Agents: <b>Generate Report</b> ğŸ“Š
  Agents --> Router: <color:#00b894><b>âœ“ Result</b></color>
  deactivate Agents
end

Router -> Router: <b>Aggregate Results</b> ğŸ“¦
Router -> Router: <b>Validate Quality Gates</b> ğŸ¯

== <b><color:#ff00ff>ğŸ›¡ï¸ PHASE 3: VALIDATION</color></b> ==
Router -> Router: <b>Check Test Coverage</b> (>80%)
Router -> Router: <b>Verify Build Success</b> âœ…
Router -> Router: <b>Security Scan</b> ğŸ”’
Router -> Router: <b>Performance Benchmarks</b> âš¡

Router -> Master: <b>Consolidated Results</b> ğŸ“‹
deactivate Router

Master -> Master: <b>Generate Narrative</b> ğŸ“–
Master -> Master: <b>Log Metrics</b> ğŸ“Š

Master --> User: <color:#00b894><b>âœ… Complete Results + Metrics</b></color>
deactivate Master

footer <b>â±ï¸ 45s Elite Mode execution (vs 5min+ sequential) | ğŸ¯ 87%% first-attempt success rate | ğŸ’¾ 62%% token savings</b>

@enduml
